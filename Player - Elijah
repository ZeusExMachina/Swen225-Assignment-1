import java.util.Set;
import java.util.HashMap;
import java.util.HashSet;
import java.util.Map;
import java.util.Scanner;

public class Player {
	private static Map<String, Card> hand;
	private final String name;
	public Game g;
	private boolean canAccuse;
	
	public Player(String name) {
		this.hand = new HashMap<>();
		this.name = name;
		this.canAccuse = true;
	}
	
	public void giveCard(Card card) { hand.put(card.name(),card); }
	
	public boolean playTurn(Game g) {
		this.g = g;
		Scanner scan;
		printCards();
		System.out.println("Would you like to roll? (Y/N): ");
		if(scan.nextLine().equals("Y")) {
			//move
			if(/*players in a room*/) {
				System.out.print("Would you like to suggest? (Y/N): ");
				if(scan.nextLine().equals("Y")) {
					System.out.print("Character: ");
					String cha = scan.next();
					System.out.print("Weapon: ");
					String weapon = scan.next();
					System.out.print("Room: ");
					String room = scan.next();
					
					CardTuple ct = new CardTuple(g.allCards.get(cha));
				}
			}
		}
	}
	
	public void clearHand() { hand.clear(); }
	
	public String toString() { return "name: " + name + ", in hand: " + hand.toString(); }
	
	/*public boolean suggest(String n1, String n2, String n3) {
		Card c1 = g.getCard(n1);
		Card c2 = g.getCard(n2);
		Card c3 = g.getCard(n3);
		while(c1 == null) {
			g.getCard(n1);
		}
		if(c2 == null) {
			
		}
		if(c3 == null) {
			
		}
		
		CardTuple tuple = new CardTuple(c1,c2,c3);
			
		
		
	}*/
	
	public boolean suggest(Game game) {
		System.out.println("Make a suggestion - type in 3 cards:");
		CardTuple suggestion = getThreeCards(game);
		game.moveViaSuggestion(suggestion);
		Card refuteCard = game.refutationProcess(this, suggestion);
		if (refuteCard == null) {
			System.out.println("Your suggestion " + suggestion.toString() + " was not refuted!");
			return false;
		} else {
			System.out.println("Your suggestion " + suggestion.toString() + " was refuted by the card " + refuteCard.toString());
			return true;
		}
	}
	
	public CardTuple getThreeCards(Game game) {
		Scanner scan = new Scanner(System.in);
		Card firstCard = askForCard(game, scan);
		Card secondCard = askForCard(game, scan);
		Card thirdCard = askForCard(game, scan);
		return new CardTuple(firstCard, secondCard, thirdCard);
	}
	
	public Card askForCard(Game game, Scanner scan) {
		System.out.print("Card: ");
		Card card = game.getCard(scan.nextLine());
		while (card == null) {
			System.out.println("Invalid card. Try again.\nCard:");
			card = game.getCard(scan.nextLine());
		}
		return card;
	}
	
	public Card refute(CardTuple tup) {
		Set<Card> refuteOptions = new HashSet<Card>();
		Card rCard = null;
		
		for(Card c : hand) {
			if(tup.characterCard().equals(c)) {
				refuteOptions.add(c);
			}
			if(tup.weaponCard().equals(c)) {
				refuteOptions.add(c);;
			}
			if(tup.roomCard().equals(c)) {
				refuteOptions.add(c);
			}
			
			
		}
		
		if(!refuteOptions.isEmpty()) {
			Card refuteCard;
			Scanner scan;
			System.out.println("What card would you like to refute with? (W/C/R)");
			for(Card c : refuteOptions) {
				System.out.println(c.getName());
			}
			
			while(refuteCard == null) {
				String choice = scan.nextLine();
				
				if(choice.equals("W") && tup.weaponCard() != null) {
					refuteCard = tup.weaponCard();
				}
				
				if(choice.equals("C") && tup.weaponCard() != null) {
					refuteCard =  tup.characterCard();
				}
				
				if(choice.equals("R") && tup.weaponCard() != null) {
					refuteCard = tup.roomCard();
				}
				
				else { System.out.println("Not a valid option please type either W,C or R");}
			}
			
			return refuteCard;
			
			
		}
		
		
	}
	
	public void printCards() {
		for(Card c : hand) {
			System.out.println(c.name());
		}
	}
	
	public boolean accuse(Game game) {
		if (!canAccuse) {
			System.out.println("You have already made an accusation before, and cannot make another.");
			return false;
		} else {
			System.out.println("Make a suggestion - type in 3 cards:");
			CardTuple accusation = getThreeCards(game);
			
		}
	}
}

